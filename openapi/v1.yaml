openapi: 3.1.0
info:
  title: claro_data API
  version: 1.0.0
  description: API base v1 para ingestion, clasificacion, analisis y gestion de contenido.
servers:
  - url: https://{api_id}.execute-api.us-east-1.amazonaws.com/prod
    variables:
      api_id:
        default: replace-me
security:
  - bearerAuth: []
tags:
  - name: Terms
  - name: Ingestion
  - name: Content
  - name: Feed
  - name: Monitor
  - name: Analysis
  - name: Exports
  - name: Meta
  - name: Connectors
  - name: Config
  - name: Audit
paths:
  /v1/health:
    get:
      summary: Healthcheck
      security: []
      responses:
        '200':
          description: API disponible
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    const: ok
                  service:
                    type: string
                  timestamp:
                    type: string
                    format: date-time
  /v1/terms:
    get:
      tags: [Terms]
      summary: Listar terminos monitoreados
      parameters:
        - $ref: '#/components/parameters/Cursor'
        - $ref: '#/components/parameters/Limit'
        - name: scope
          in: query
          schema:
            $ref: '#/components/schemas/TermScope'
          description: Filtra terminos por alcance de monitoreo (`claro|competencia`).
      responses:
        '200':
          description: Lista de terminos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TermListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '422':
          $ref: '#/components/responses/ValidationError'
    post:
      tags: [Terms]
      summary: Crear termino monitoreado
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTermRequest'
      responses:
        '201':
          description: Termino creado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Term'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          $ref: '#/components/responses/Conflict'
        '422':
          $ref: '#/components/responses/ValidationError'
  /v1/terms/{id}:
    patch:
      tags: [Terms]
      summary: Editar termino monitoreado
      parameters:
        - $ref: '#/components/parameters/Id'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTermRequest'
      responses:
        '200':
          description: Termino actualizado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Term'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '422':
          $ref: '#/components/responses/ValidationError'
  /v1/ingestion/runs:
    post:
      tags: [Ingestion]
      summary: Disparar corrida manual de ingestion
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateIngestionRunRequest'
      responses:
        '202':
          description: Corrida aceptada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IngestionRunAccepted'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'
  /v1/content:
    get:
      tags: [Content]
      summary: Listado de contenido con filtros avanzados y cursor
      parameters:
        - $ref: '#/components/parameters/Cursor'
        - $ref: '#/components/parameters/Limit'
        - name: state
          in: query
          schema:
            $ref: '#/components/schemas/ContentState'
        - name: source_type
          in: query
          schema:
            $ref: '#/components/schemas/SourceType'
        - name: term_id
          in: query
          schema:
            type: string
            format: uuid
        - name: provider
          in: query
          schema:
            type: string
        - name: category
          in: query
          schema:
            type: string
        - name: sentimiento
          in: query
          schema:
            type: string
        - name: from
          in: query
          schema:
            type: string
            format: date-time
        - name: to
          in: query
          schema:
            type: string
            format: date-time
        - name: q
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Lista paginada de contenido
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContentListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '422':
          $ref: '#/components/responses/ValidationError'
  /v1/feed/news:
    get:
      tags: [Feed]
      summary: Feed de noticias por query (maximo 2 items mas recientes)
      parameters:
        - name: term_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Feed de noticias mas recientes para la query
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NewsFeedResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'
  /v1/monitor/overview:
    get:
      tags: [Monitor]
      summary: KPIs de overview (V1 news-only, ventana fija de 7 dias)
      responses:
        '200':
          description: Resumen KPI de monitoreo
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MonitorOverviewResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          description: Error interno
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /v1/monitor/incidents:
    get:
      tags: [Monitor]
      summary: Listado paginado de incidentes operativos
      parameters:
        - $ref: '#/components/parameters/Cursor'
        - $ref: '#/components/parameters/Limit'
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/IncidentStatus'
        - name: severity
          in: query
          schema:
            $ref: '#/components/schemas/MonitorSeverity'
        - name: scope
          in: query
          schema:
            $ref: '#/components/schemas/TermScope'
        - name: owner_user_id
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Lista de incidentes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IncidentListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '422':
          $ref: '#/components/responses/ValidationError'
  /v1/monitor/incidents/evaluate:
    post:
      tags: [Monitor]
      summary: Disparar evaluacion manual de incidentes
      responses:
        '202':
          description: Evaluacion encolada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IncidentEvaluationAccepted'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /v1/monitor/incidents/{id}:
    patch:
      tags: [Monitor]
      summary: Actualizar estado, owner y/o nota de un incidente
      parameters:
        - $ref: '#/components/parameters/Id'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatchIncidentRequest'
      responses:
        '200':
          description: Incidente actualizado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PatchIncidentResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '422':
          $ref: '#/components/responses/ValidationError'
  /v1/monitor/incidents/{id}/notes:
    get:
      tags: [Monitor]
      summary: Listar notas de incidente
      parameters:
        - $ref: '#/components/parameters/Id'
        - $ref: '#/components/parameters/Limit'
      responses:
        '200':
          description: Notas del incidente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IncidentNotesResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'
    post:
      tags: [Monitor]
      summary: Agregar nota de incidente
      parameters:
        - $ref: '#/components/parameters/Id'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateIncidentNoteRequest'
      responses:
        '201':
          description: Nota creada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IncidentNote'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'
  /v1/analyze/overview:
    get:
      tags: [Analysis]
      summary: Overview de analisis con variacion contra periodo anterior
      responses:
        '200':
          description: Resumen de analisis V1 (news-only, ventana fija de 7 dias)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalyzeOverviewResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          description: Error interno
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /v1/analyze/channel:
    get:
      tags: [Analysis]
      summary: Analisis por canal/proveedor
      parameters:
        - $ref: '#/components/parameters/Limit'
      responses:
        '200':
          description: Desglose por canal/proveedor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalyzeChannelResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          description: Error interno
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /v1/analyze/competitors:
    get:
      tags: [Analysis]
      summary: Benchmark de competencia sobre set cerrado (scope=competencia)
      parameters:
        - $ref: '#/components/parameters/Limit'
      responses:
        '200':
          description: Benchmark de competidores
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalyzeCompetitorsResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '422':
          $ref: '#/components/responses/ValidationError'
        '500':
          description: Error interno
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /v1/content/{id}/state:
    patch:
      tags: [Content]
      summary: Cambiar estado de un item
      parameters:
        - $ref: '#/components/parameters/Id'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateContentStateRequest'
      responses:
        '200':
          description: Estado actualizado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContentStateEvent'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '422':
          $ref: '#/components/responses/ValidationError'
  /v1/content/bulk/state:
    post:
      tags: [Content]
      summary: Cambiar estado de varios items
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BulkUpdateContentStateRequest'
      responses:
        '200':
          description: Resultado de accion masiva
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BulkActionResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '422':
          $ref: '#/components/responses/ValidationError'
  /v1/content/{id}/classification:
    patch:
      tags: [Content]
      summary: Override manual de clasificacion
      parameters:
        - $ref: '#/components/parameters/Id'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateClassificationRequest'
      responses:
        '200':
          description: Clasificacion actualizada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Classification'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'
  /v1/analysis/runs:
    post:
      tags: [Analysis]
      summary: Ejecutar analisis agregado
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAnalysisRunRequest'
      responses:
        '202':
          description: Analisis en proceso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalysisRunAccepted'
  /v1/analysis/history:
    get:
      tags: [Analysis]
      summary: Historial de analisis
      parameters:
        - $ref: '#/components/parameters/Cursor'
        - $ref: '#/components/parameters/Limit'
      responses:
        '200':
          description: Historial paginado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalysisRunListResponse'
  /v1/exports/csv:
    post:
      tags: [Exports]
      summary: Exportar resultados a CSV
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCsvExportRequest'
      responses:
        '202':
          description: Export en proceso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExportAccepted'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '422':
          $ref: '#/components/responses/ValidationError'
  /v1/exports/{id}:
    get:
      tags: [Exports]
      summary: Consultar estado de export y URL de descarga
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '200':
          description: Estado actual del export
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExportStatusResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'
  /v1/meta:
    get:
      tags: [Meta]
      summary: Catalogos de filtros
      responses:
        '200':
          description: Catalogos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetaResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /v1/connectors:
    get:
      tags: [Connectors]
      summary: Listar configuracion de conectores
      parameters:
        - $ref: '#/components/parameters/Limit'
      responses:
        '200':
          description: Lista de conectores
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConnectorListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /v1/connectors/{id}:
    patch:
      tags: [Connectors]
      summary: Actualizar configuracion de conector
      parameters:
        - $ref: '#/components/parameters/Id'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatchConnectorRequest'
      responses:
        '200':
          description: Conector actualizado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Connector'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '422':
          $ref: '#/components/responses/ValidationError'
  /v1/connectors/{id}/sync:
    post:
      tags: [Connectors]
      summary: Disparar sincronizacion manual de conector
      parameters:
        - $ref: '#/components/parameters/Id'
      responses:
        '202':
          description: Corrida de sincronizacion aceptada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConnectorSyncRun'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'
  /v1/connectors/{id}/runs:
    get:
      tags: [Connectors]
      summary: Historial de corridas de sincronizacion de un conector
      parameters:
        - $ref: '#/components/parameters/Id'
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: Lista de corridas de sincronizacion
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConnectorRunListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'
  /v1/config/accounts:
    get:
      tags: [Config]
      summary: Listar cuentas propias monitoreadas
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 300
            default: 200
      responses:
        '200':
          description: Lista de cuentas
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OwnedAccountListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    post:
      tags: [Config]
      summary: Crear cuenta propia
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOwnedAccountRequest'
      responses:
        '201':
          description: Cuenta creada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OwnedAccount'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          $ref: '#/components/responses/Conflict'
        '422':
          $ref: '#/components/responses/ValidationError'
  /v1/config/accounts/{id}:
    patch:
      tags: [Config]
      summary: Actualizar cuenta propia
      parameters:
        - $ref: '#/components/parameters/Id'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateOwnedAccountRequest'
      responses:
        '200':
          description: Cuenta actualizada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OwnedAccount'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '422':
          $ref: '#/components/responses/ValidationError'
  /v1/config/competitors:
    get:
      tags: [Config]
      summary: Listar competidores
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 300
            default: 200
      responses:
        '200':
          description: Lista de competidores
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompetitorListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    post:
      tags: [Config]
      summary: Crear competidor
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCompetitorRequest'
      responses:
        '201':
          description: Competidor creado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Competitor'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          $ref: '#/components/responses/Conflict'
        '422':
          $ref: '#/components/responses/ValidationError'
  /v1/config/competitors/{id}:
    patch:
      tags: [Config]
      summary: Actualizar competidor
      parameters:
        - $ref: '#/components/parameters/Id'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCompetitorRequest'
      responses:
        '200':
          description: Competidor actualizado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Competitor'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '422':
          $ref: '#/components/responses/ValidationError'
  /v1/config/taxonomies/{kind}:
    get:
      tags: [Config]
      summary: Listar entradas de taxonomia por tipo
      parameters:
        - $ref: '#/components/parameters/TaxonomyKind'
        - name: include_inactive
          in: query
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Entradas de taxonomia
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaxonomyListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '422':
          $ref: '#/components/responses/ValidationError'
    post:
      tags: [Config]
      summary: Crear entrada de taxonomia
      parameters:
        - $ref: '#/components/parameters/TaxonomyKind'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTaxonomyEntryRequest'
      responses:
        '201':
          description: Entrada creada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaxonomyEntry'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          $ref: '#/components/responses/Conflict'
        '422':
          $ref: '#/components/responses/ValidationError'
  /v1/config/taxonomies/{kind}/{id}:
    patch:
      tags: [Config]
      summary: Actualizar entrada de taxonomia
      parameters:
        - $ref: '#/components/parameters/TaxonomyKind'
        - $ref: '#/components/parameters/Id'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTaxonomyEntryRequest'
      responses:
        '200':
          description: Entrada actualizada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaxonomyEntry'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '422':
          $ref: '#/components/responses/ValidationError'
  /v1/config/audit:
    get:
      tags: [Audit]
      summary: Listar auditoria de configuracion
      parameters:
        - $ref: '#/components/parameters/Cursor'
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 500
            default: 100
        - name: resource_type
          in: query
          schema:
            type: string
        - name: action
          in: query
          schema:
            type: string
        - name: actor_user_id
          in: query
          schema:
            type: string
            format: uuid
        - name: from
          in: query
          schema:
            type: string
            format: date-time
        - name: to
          in: query
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: Auditoria paginada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '422':
          $ref: '#/components/responses/ValidationError'
  /v1/config/audit/export:
    post:
      tags: [Audit]
      summary: Exportar auditoria a CSV (sanitizado por rol)
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAuditExportRequest'
      responses:
        '202':
          description: Export generado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditExportResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '422':
          $ref: '#/components/responses/ValidationError'
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  responses:
    Unauthorized:
      description: JWT invalido o ausente
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Forbidden:
      description: Rol insuficiente para ejecutar la accion
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    ValidationError:
      description: Error de validacion de datos de entrada
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Conflict:
      description: Conflicto de datos (duplicado/estado invalido)
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    NotFound:
      description: Recurso no encontrado
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
  parameters:
    Id:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: uuid
    Cursor:
      name: cursor
      in: query
      schema:
        type: string
      description: Cursor opaco para paginacion
    Limit:
      name: limit
      in: query
      schema:
        type: integer
        minimum: 1
        maximum: 200
        default: 50
    TaxonomyKind:
      name: kind
      in: path
      required: true
      schema:
        type: string
        enum: [categories, business_lines, macro_regions, campaigns]
  schemas:
    ErrorResponse:
      type: object
      required: [error, message]
      properties:
        error:
          type: string
        message:
          type: string
    UserRole:
      type: string
      enum: [Admin, Analyst, Viewer]
    SourceType:
      type: string
      enum: [news, social]
    ContentState:
      type: string
      enum: [active, archived, hidden]
    TermScope:
      type: string
      enum: [claro, competencia]
    Term:
      type: object
      required: [id, name, scope, is_active, created_at]
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        language:
          type: string
          default: es
        scope:
          $ref: '#/components/schemas/TermScope'
        is_active:
          type: boolean
        schedule:
          type: string
          description: cron/rule de ingestion
        max_articles_per_run:
          type: integer
          default: 100
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    TermListResponse:
      type: object
      required: [items, page_info]
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Term'
        page_info:
          $ref: '#/components/schemas/PageInfo'
    CreateTermRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
          minLength: 2
        language:
          type: string
          default: es
        scope:
          $ref: '#/components/schemas/TermScope'
          default: claro
        max_articles_per_run:
          type: integer
          minimum: 1
          maximum: 500
          default: 100
    UpdateTermRequest:
      type: object
      properties:
        name:
          type: string
        language:
          type: string
        scope:
          $ref: '#/components/schemas/TermScope'
        is_active:
          type: boolean
        max_articles_per_run:
          type: integer
          minimum: 1
          maximum: 500
    ContentItem:
      type: object
      required: [id, source_type, state, title, canonical_url, created_at]
      properties:
        id:
          type: string
          format: uuid
        source_type:
          $ref: '#/components/schemas/SourceType'
        term_id:
          type: string
          format: uuid
        provider:
          type: string
        source_name:
          type: string
        source_id:
          type: string
        state:
          $ref: '#/components/schemas/ContentState'
        title:
          type: string
        summary:
          type: string
        content:
          type: string
        canonical_url:
          type: string
          format: uri
        image_url:
          type: string
          format: uri
        language:
          type: string
        category:
          type: string
        published_at:
          type: string
          format: date-time
        source_score:
          type: number
          minimum: 0
          maximum: 1
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        raw_payload_s3_key:
          type: string
        categoria:
          type: string
        sentimiento:
          type: string
    Classification:
      type: object
      required: [id, content_item_id, categoria, sentimiento, prompt_version, model_id, created_at]
      properties:
        id:
          type: string
          format: uuid
        content_item_id:
          type: string
          format: uuid
        categoria:
          type: string
        sentimiento:
          type: string
        etiquetas:
          type: array
          items:
            type: string
        confianza:
          type: number
          minimum: 0
          maximum: 1
        override_by:
          type: string
          format: uuid
        prompt_version:
          type: string
        model_id:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    ContentStateEvent:
      type: object
      required: [id, content_item_id, previous_state, next_state, actor_user_id, created_at]
      properties:
        id:
          type: string
          format: uuid
        content_item_id:
          type: string
          format: uuid
        previous_state:
          $ref: '#/components/schemas/ContentState'
        next_state:
          $ref: '#/components/schemas/ContentState'
        actor_user_id:
          type: string
          format: uuid
        reason:
          type: string
        created_at:
          type: string
          format: date-time
    CreateIngestionRunRequest:
      type: object
      properties:
        run_id:
          type: string
          format: uuid
        terms:
          type: array
          items:
            type: string
        term_ids:
          type: array
          items:
            type: string
            format: uuid
        language:
          type: string
          default: es
        max_articles_per_term:
          type: integer
          minimum: 1
          maximum: 500
          default: 100
          description: Valor solicitado; para `source_type=news` el valor efectivo aplicado por runtime es 2.
    IngestionRunAccepted:
      type: object
      required: [run_id, status, input]
      properties:
        run_id:
          type: string
          format: uuid
        status:
          type: string
          const: accepted
        execution_arn:
          type: string
          nullable: true
        start_date:
          type: string
          format: date-time
          nullable: true
        skip_reason:
          type: string
          nullable: true
        input:
          type: object
          properties:
            triggerType:
              type: string
            runId:
              type: string
              format: uuid
            requestId:
              type: string
            requestedAt:
              type: string
              format: date-time
            termIds:
              type: array
              items:
                type: string
                format: uuid
            terms:
              type: array
              items:
                type: string
            language:
              type: string
            maxArticlesPerTerm:
              type: integer
              description: Valor efectivo aplicado por runtime (news fijo en 2).
            requestedMaxArticlesPerTerm:
              type: integer
              description: Valor solicitado por el cliente antes de aplicar politicas de limite.
    UpdateContentStateRequest:
      type: object
      required: [target_state]
      properties:
        target_state:
          $ref: '#/components/schemas/ContentState'
        reason:
          type: string
    BulkUpdateContentStateRequest:
      type: object
      required: [ids, target_state]
      properties:
        ids:
          type: array
          minItems: 1
          items:
            type: string
            format: uuid
        target_state:
          $ref: '#/components/schemas/ContentState'
        reason:
          type: string
    BulkActionResponse:
      type: object
      required: [processed, failed]
      properties:
        processed:
          type: integer
        failed:
          type: integer
        failures:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
                format: uuid
              error:
                type: string
              message:
                type: string
    UpdateClassificationRequest:
      type: object
      required: [categoria, sentimiento]
      properties:
        categoria:
          type: string
        sentimiento:
          type: string
        etiquetas:
          type: array
          items:
            type: string
        confidence_override:
          type: number
          minimum: 0
          maximum: 1
        reason:
          type: string
    CreateAnalysisRunRequest:
      type: object
      properties:
        term_id:
          type: string
          format: uuid
        content_ids:
          type: array
          items:
            type: string
            format: uuid
        limit:
          type: integer
          minimum: 1
          maximum: 200
          default: 100
    AnalysisRunAccepted:
      type: object
      required: [analysis_run_id, status]
      properties:
        analysis_run_id:
          type: string
          format: uuid
        status:
          type: string
          const: accepted
    AnalysisRun:
      type: object
      required: [id, status, created_at]
      properties:
        id:
          type: string
          format: uuid
        term_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [queued, running, completed, failed]
        output:
          type: object
          additionalProperties: true
        created_at:
          type: string
          format: date-time
    AnalysisRunListResponse:
      type: object
      required: [items, page_info]
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/AnalysisRun'
        page_info:
          $ref: '#/components/schemas/PageInfo'
    CreateCsvExportRequest:
      type: object
      properties:
        filters:
          type: object
          properties:
            state:
              $ref: '#/components/schemas/ContentState'
            source_type:
              $ref: '#/components/schemas/SourceType'
            term_id:
              type: string
              format: uuid
            provider:
              type: string
            category:
              type: string
            sentimiento:
              type: string
            from:
              type: string
              format: date-time
            to:
              type: string
              format: date-time
            q:
              type: string
          additionalProperties: false
    ExportAccepted:
      type: object
      required: [export_id, status]
      properties:
        export_id:
          type: string
          format: uuid
        status:
          type: string
          const: accepted
    ExportStatusResponse:
      type: object
      required: [export_id, status, row_count, created_at]
      properties:
        export_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [queued, running, completed, failed]
        row_count:
          type: integer
        created_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
          nullable: true
        download_url:
          type: string
          format: uri
          nullable: true
        filters:
          type: object
          additionalProperties: true
    MonitorSeverity:
      type: string
      enum: [SEV1, SEV2, SEV3, SEV4]
    IncidentStatus:
      type: string
      enum: [open, acknowledged, in_progress, resolved, dismissed]
    MonitorScopeKpi:
      type: object
      required:
        [items, classified_items, positivos, negativos, neutrales, sentimiento_neto, riesgo_activo, quality_score, bhs, sov, insufficient_data]
      properties:
        items:
          type: integer
        classified_items:
          type: integer
        positivos:
          type: integer
        negativos:
          type: integer
        neutrales:
          type: integer
        sentimiento_neto:
          type: number
        riesgo_activo:
          type: number
        quality_score:
          type: number
        bhs:
          type: number
        sov:
          type: number
        insufficient_data:
          type: boolean
    MonitorTotalsKpi:
      type: object
      required: [items, classified_items, sentimiento_neto, bhs, riesgo_activo, severidad, sov_claro, sov_competencia, insufficient_data]
      properties:
        items:
          type: integer
        classified_items:
          type: integer
        sentimiento_neto:
          type: number
        bhs:
          type: number
        riesgo_activo:
          type: number
        severidad:
          $ref: '#/components/schemas/MonitorSeverity'
        sov_claro:
          type: number
        sov_competencia:
          type: number
        insufficient_data:
          type: boolean
    MonitorDiagnostics:
      type: object
      required: [unscoped_items, unknown_sentiment_items]
      properties:
        unscoped_items:
          type: integer
        unknown_sentiment_items:
          type: integer
    MonitorOverviewResponse:
      type: object
      required: [generated_at, window_days, source_type, formula_version, totals, by_scope, diagnostics]
      properties:
        generated_at:
          type: string
          format: date-time
        window_days:
          type: integer
          const: 7
        source_type:
          type: string
          const: news
        formula_version:
          type: string
          const: kpi-v1
        totals:
          $ref: '#/components/schemas/MonitorTotalsKpi'
        by_scope:
          type: object
          required: [claro, competencia]
          properties:
            claro:
              $ref: '#/components/schemas/MonitorScopeKpi'
            competencia:
              $ref: '#/components/schemas/MonitorScopeKpi'
        diagnostics:
          $ref: '#/components/schemas/MonitorDiagnostics'
    AnalyzeOverviewDelta:
      type: object
      required: [items, classified_items, sentimiento_neto, bhs, riesgo_activo, sov_claro, sov_competencia]
      properties:
        items:
          type: integer
        classified_items:
          type: integer
        sentimiento_neto:
          type: number
        bhs:
          type: number
        riesgo_activo:
          type: number
        sov_claro:
          type: number
        sov_competencia:
          type: number
    AnalyzeOverviewResponse:
      type: object
      required: [generated_at, window_days, source_type, formula_version, totals, previous_totals, delta, by_scope, diagnostics]
      properties:
        generated_at:
          type: string
          format: date-time
        window_days:
          type: integer
          const: 7
        source_type:
          type: string
          const: news
        formula_version:
          type: string
          const: analysis-v1
        totals:
          $ref: '#/components/schemas/MonitorTotalsKpi'
        previous_totals:
          $ref: '#/components/schemas/MonitorTotalsKpi'
        delta:
          $ref: '#/components/schemas/AnalyzeOverviewDelta'
        by_scope:
          type: object
          required: [claro, competencia]
          properties:
            claro:
              $ref: '#/components/schemas/MonitorScopeKpi'
            competencia:
              $ref: '#/components/schemas/MonitorScopeKpi'
        diagnostics:
          $ref: '#/components/schemas/MonitorDiagnostics'
    AnalyzeCategoryCount:
      type: object
      required: [value, count]
      properties:
        value:
          type: string
        count:
          type: integer
    AnalyzeChannelItem:
      type: object
      required:
        [provider, items, classified_items, positivos, negativos, neutrales, sentimiento_neto, riesgo_activo, quality_score, bhs, severidad, top_categories, insufficient_data]
      properties:
        provider:
          type: string
        items:
          type: integer
        classified_items:
          type: integer
        positivos:
          type: integer
        negativos:
          type: integer
        neutrales:
          type: integer
        sentimiento_neto:
          type: number
        riesgo_activo:
          type: number
        quality_score:
          type: number
        bhs:
          type: number
        severidad:
          $ref: '#/components/schemas/MonitorSeverity'
        top_categories:
          type: array
          items:
            $ref: '#/components/schemas/AnalyzeCategoryCount'
        insufficient_data:
          type: boolean
    AnalyzeChannelResponse:
      type: object
      required: [generated_at, window_days, source_type, formula_version, totals, items]
      properties:
        generated_at:
          type: string
          format: date-time
        window_days:
          type: integer
          const: 7
        source_type:
          type: string
          const: news
        formula_version:
          type: string
          const: analysis-v1
        totals:
          type: object
          required: [providers, items, classified_items]
          properties:
            providers:
              type: integer
            items:
              type: integer
            classified_items:
              type: integer
        items:
          type: array
          items:
            $ref: '#/components/schemas/AnalyzeChannelItem'
    AnalyzeScopeBenchmark:
      type: object
      required:
        [items, classified_items, positivos, negativos, neutrales, sentimiento_neto, riesgo_activo, quality_score, bhs, severidad, sov, insufficient_data]
      properties:
        items:
          type: integer
        classified_items:
          type: integer
        positivos:
          type: integer
        negativos:
          type: integer
        neutrales:
          type: integer
        sentimiento_neto:
          type: number
        riesgo_activo:
          type: number
        quality_score:
          type: number
        bhs:
          type: number
        severidad:
          $ref: '#/components/schemas/MonitorSeverity'
        sov:
          type: number
        insufficient_data:
          type: boolean
    AnalyzeCompetitorItem:
      allOf:
        - $ref: '#/components/schemas/AnalyzeScopeBenchmark'
        - type: object
          required: [term_id, term_name]
          properties:
            term_id:
              type: string
              format: uuid
            term_name:
              type: string
    AnalyzeCompetitorsResponse:
      type: object
      required: [generated_at, window_days, source_type, formula_version, baseline_claro, competitors, totals]
      properties:
        generated_at:
          type: string
          format: date-time
        window_days:
          type: integer
          const: 7
        source_type:
          type: string
          const: news
        formula_version:
          type: string
          const: analysis-v1
        baseline_claro:
          $ref: '#/components/schemas/AnalyzeScopeBenchmark'
        competitors:
          type: array
          items:
            $ref: '#/components/schemas/AnalyzeCompetitorItem'
        totals:
          type: object
          required: [competitor_terms, items, classified_items]
          properties:
            competitor_terms:
              type: integer
            items:
              type: integer
            classified_items:
              type: integer
    IncidentOwner:
      type: object
      required: [user_id]
      properties:
        user_id:
          type: string
          format: uuid
        name:
          type: string
          nullable: true
        email:
          type: string
          nullable: true
        role:
          type: string
          nullable: true
    Incident:
      type: object
      required:
        [
          id,
          scope,
          severity,
          status,
          risk_score,
          classified_items,
          sla_due_at,
          sla_remaining_minutes,
          cooldown_until,
          signal_version,
          payload,
          created_at,
          updated_at
        ]
      properties:
        id:
          type: string
          format: uuid
        scope:
          $ref: '#/components/schemas/TermScope'
        severity:
          $ref: '#/components/schemas/MonitorSeverity'
        status:
          $ref: '#/components/schemas/IncidentStatus'
        risk_score:
          type: number
        classified_items:
          type: integer
        owner_user_id:
          type: string
          format: uuid
          nullable: true
        owner:
          allOf:
            - $ref: '#/components/schemas/IncidentOwner'
          nullable: true
        sla_due_at:
          type: string
          format: date-time
        sla_remaining_minutes:
          type: integer
        cooldown_until:
          type: string
          format: date-time
        signal_version:
          type: string
        payload:
          type: object
          additionalProperties: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        resolved_at:
          type: string
          format: date-time
          nullable: true
    IncidentListResponse:
      type: object
      required: [items, page_info]
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Incident'
        page_info:
          $ref: '#/components/schemas/PageInfo'
    PatchIncidentRequest:
      type: object
      properties:
        status:
          $ref: '#/components/schemas/IncidentStatus'
        owner_user_id:
          type: string
          format: uuid
          nullable: true
        note:
          type: string
          minLength: 1
          maxLength: 2000
      additionalProperties: false
    IncidentNote:
      type: object
      required: [id, incident_id, author_user_id, author, note, created_at]
      properties:
        id:
          type: string
          format: uuid
        incident_id:
          type: string
          format: uuid
        author_user_id:
          type: string
          format: uuid
        author:
          $ref: '#/components/schemas/IncidentOwner'
        note:
          type: string
        created_at:
          type: string
          format: date-time
    PatchIncidentResponse:
      type: object
      required: [incident]
      properties:
        incident:
          $ref: '#/components/schemas/Incident'
        note:
          allOf:
            - $ref: '#/components/schemas/IncidentNote'
          nullable: true
    IncidentNotesResponse:
      type: object
      required: [items]
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/IncidentNote'
    CreateIncidentNoteRequest:
      type: object
      required: [note]
      properties:
        note:
          type: string
          minLength: 1
          maxLength: 2000
      additionalProperties: false
    IncidentEvaluationAccepted:
      type: object
      required: [status, trigger_type]
      properties:
        status:
          type: string
          const: queued
        trigger_type:
          type: string
          enum: [manual]
        message_id:
          type: string
          nullable: true
    MetaResponse:
      type: object
      properties:
        providers:
          type: array
          items:
            $ref: '#/components/schemas/MetaCountItem'
        categories:
          type: array
          items:
            $ref: '#/components/schemas/MetaCountItem'
        sentimientos:
          type: array
          items:
            $ref: '#/components/schemas/MetaCountItem'
        states:
          type: array
          items:
            $ref: '#/components/schemas/MetaCountItem'
    MetaCountItem:
      type: object
      required: [value, count]
      properties:
        value:
          type: string
        count:
          type: integer
    ConnectorHealth:
      type: string
      enum: [unknown, healthy, degraded, offline]
    Connector:
      type: object
      required: [id, provider, enabled, frequency_minutes, health_status, created_at, updated_at]
      properties:
        id:
          type: string
          format: uuid
        provider:
          type: string
        enabled:
          type: boolean
        frequency_minutes:
          type: integer
        health_status:
          $ref: '#/components/schemas/ConnectorHealth'
        last_sync_at:
          type: string
          format: date-time
          nullable: true
        last_error:
          type: string
          nullable: true
        latency_p95_ms:
          type: integer
          nullable: true
        metadata:
          type: object
          additionalProperties: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    PatchConnectorRequest:
      type: object
      properties:
        enabled:
          type: boolean
        frequency_minutes:
          type: integer
          minimum: 5
          maximum: 1440
    ConnectorSyncRun:
      type: object
      required: [id, connector_id, status, created_at]
      properties:
        id:
          type: string
          format: uuid
        connector_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [queued, running, completed, failed]
        started_at:
          type: string
          format: date-time
          nullable: true
        finished_at:
          type: string
          format: date-time
          nullable: true
        metrics:
          type: object
          additionalProperties: true
        error:
          type: string
          nullable: true
        triggered_by_user_id:
          type: string
          format: uuid
          nullable: true
        created_at:
          type: string
          format: date-time
    ConnectorListResponse:
      type: object
      required: [items]
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Connector'
    ConnectorRunListResponse:
      type: object
      required: [connector_id, items]
      properties:
        connector_id:
          type: string
          format: uuid
        items:
          type: array
          items:
            $ref: '#/components/schemas/ConnectorSyncRun'
    OwnedAccount:
      type: object
      required: [id, plataforma, handle, nombre_cuenta, idioma, estado, tags_campana, created_at, updated_at]
      properties:
        id:
          type: string
          format: uuid
        plataforma:
          type: string
        handle:
          type: string
        nombre_cuenta:
          type: string
        linea_negocio:
          type: string
          nullable: true
        region_macro:
          type: string
          nullable: true
        idioma:
          type: string
        owner_equipo:
          type: string
          nullable: true
        estado:
          type: string
        tags_campana:
          type: array
          items:
            type: string
        metadata:
          type: object
          additionalProperties: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    OwnedAccountListResponse:
      type: object
      required: [items]
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/OwnedAccount'
    CreateOwnedAccountRequest:
      type: object
      required: [platform, handle, account_name]
      properties:
        platform:
          type: string
          minLength: 1
        handle:
          type: string
          minLength: 2
        account_name:
          type: string
          minLength: 2
        business_line:
          type: string
        macro_region:
          type: string
        language:
          type: string
          default: es
        team_owner:
          type: string
        status:
          type: string
          default: active
        campaign_tags:
          type: array
          items:
            type: string
        metadata:
          type: object
          additionalProperties: true
    UpdateOwnedAccountRequest:
      type: object
      properties:
        platform:
          type: string
        handle:
          type: string
        account_name:
          type: string
        business_line:
          type: string
          nullable: true
        macro_region:
          type: string
          nullable: true
        language:
          type: string
        team_owner:
          type: string
          nullable: true
        status:
          type: string
        campaign_tags:
          type: array
          items:
            type: string
        metadata:
          type: object
          additionalProperties: true
    Competitor:
      type: object
      required: [id, marca_competidora, aliases, prioridad, estado, created_at, updated_at]
      properties:
        id:
          type: string
          format: uuid
        marca_competidora:
          type: string
        aliases:
          type: array
          items:
            type: string
        prioridad:
          type: integer
        estado:
          type: string
        metadata:
          type: object
          additionalProperties: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    CompetitorListResponse:
      type: object
      required: [items]
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Competitor'
    CreateCompetitorRequest:
      type: object
      required: [brand_name]
      properties:
        brand_name:
          type: string
        aliases:
          type: array
          items:
            type: string
        priority:
          type: integer
          minimum: 1
          maximum: 10
        status:
          type: string
        metadata:
          type: object
          additionalProperties: true
    UpdateCompetitorRequest:
      type: object
      properties:
        brand_name:
          type: string
        aliases:
          type: array
          items:
            type: string
        priority:
          type: integer
          minimum: 1
          maximum: 10
        status:
          type: string
        metadata:
          type: object
          additionalProperties: true
    TaxonomyEntry:
      type: object
      required: [id, kind, key, label, is_active, sort_order, created_at, updated_at]
      properties:
        id:
          type: string
          format: uuid
        kind:
          type: string
          enum: [categories, business_lines, macro_regions, campaigns]
        key:
          type: string
        label:
          type: string
        description:
          type: string
          nullable: true
        is_active:
          type: boolean
        sort_order:
          type: integer
        metadata:
          type: object
          additionalProperties: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    TaxonomyListResponse:
      type: object
      required: [kind, items]
      properties:
        kind:
          type: string
          enum: [categories, business_lines, macro_regions, campaigns]
        items:
          type: array
          items:
            $ref: '#/components/schemas/TaxonomyEntry'
    CreateTaxonomyEntryRequest:
      type: object
      required: [key, label]
      properties:
        key:
          type: string
        label:
          type: string
        description:
          type: string
        is_active:
          type: boolean
          default: true
        sort_order:
          type: integer
          default: 100
        metadata:
          type: object
          additionalProperties: true
    UpdateTaxonomyEntryRequest:
      type: object
      properties:
        key:
          type: string
        label:
          type: string
        description:
          type: string
          nullable: true
        is_active:
          type: boolean
        sort_order:
          type: integer
        metadata:
          type: object
          additionalProperties: true
    AuditItem:
      type: object
      required: [id, action, resource_type, created_at]
      properties:
        id:
          type: string
          format: uuid
        actor_user_id:
          type: string
          format: uuid
          nullable: true
        actor_email:
          type: string
          nullable: true
        actor_name:
          type: string
          nullable: true
        actor_role:
          type: string
          nullable: true
        action:
          type: string
        resource_type:
          type: string
        resource_id:
          type: string
          nullable: true
        request_id:
          type: string
          nullable: true
        before:
          type: object
          nullable: true
          additionalProperties: true
        after:
          type: object
          nullable: true
          additionalProperties: true
        created_at:
          type: string
          format: date-time
    AuditListResponse:
      type: object
      required: [items, page_info]
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/AuditItem'
        page_info:
          $ref: '#/components/schemas/PageInfo'
    CreateAuditExportRequest:
      type: object
      properties:
        filters:
          type: object
          properties:
            resource_type:
              type: string
            action:
              type: string
            actor_user_id:
              type: string
              format: uuid
            from:
              type: string
              format: date-time
            to:
              type: string
              format: date-time
          additionalProperties: false
        limit:
          type: integer
          minimum: 1
          maximum: 5000
          default: 2000
    AuditExportResponse:
      type: object
      required: [export_id, status, format, row_count, created_at, download_url]
      properties:
        export_id:
          type: string
          format: uuid
        status:
          type: string
          const: completed
        format:
          type: string
          const: csv
        row_count:
          type: integer
        created_at:
          type: string
          format: date-time
        download_url:
          type: string
          format: uri
        s3_key:
          type: string
        requested_by_user_id:
          type: string
          format: uuid
        request_id:
          type: string
    ContentListResponse:
      type: object
      required: [items, page_info]
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/ContentItem'
        page_info:
          $ref: '#/components/schemas/PageInfo'
    NewsFeedResponse:
      type: object
      required: [term_id, limit, items]
      properties:
        term_id:
          type: string
          format: uuid
        limit:
          type: integer
          const: 2
        items:
          type: array
          maxItems: 2
          items:
            $ref: '#/components/schemas/ContentItem'
    PageInfo:
      type: object
      required: [has_next]
      properties:
        next_cursor:
          type: string
          nullable: true
        has_next:
          type: boolean
